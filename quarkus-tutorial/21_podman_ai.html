<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Working with Podman Desktop AI Lab :: Quarkus Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/quarkus-tutorial/quarkus-tutorial/21_podman_ai.html">
    <link rel="prev" href="20_embed_documents.html">
    <link rel="next" href="22_local_models.html">
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-developer-demos.github.io/quarkus-tutorial">Quarkus Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="quarkus-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Requirements</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01_setup.html">Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basics</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02_basics.html">Basics and Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04_panache.html">Hibernate with Panache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05_kubernetes.html">Deploy to Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06_dev-services.html">Dev Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07_spring.html">Spring Compatibility</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud Native</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="08_rest-client.html">REST Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09_fault-tolerance.html">Fault Tolerance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10_health.html">Health Check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11_observability.html">Observability</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12_security.html">Security with JWT RBAC</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reactive</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14_reactive.html">Reactive with Mutiny</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15_reactive-messaging.html">Streaming reactive messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15_kafka-and-streams.html">Apache Kafka with Reactive Streams</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">AI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="17_prompts.html">Working with prompts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="18_chains_memory.html">Chains and Memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19_agents_tools.html">Agents/Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20_embed_documents.html">Embedding Documents</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="21_podman_ai.html">Working with Podman Desktop AI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="22_local_models.html">Working with local models</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">quarkus-tutorial</a></li>
    <li>AI</li>
    <li><a href="21_podman_ai.html">Working with Podman Desktop AI</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-developer-demos/quarkus-tutorial/edit/master/documentation/modules/ROOT/pages/21_podman_ai.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Working with Podman Desktop AI Lab</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Throughout this tutorial, we&#8217;ve been working with OpenAI&#8217;s remote models, however wouldn&#8217;t it be nice if we could work
with models on our local machine (without incurring costs)?</p>
</div>
<div class="paragraph">
<p>Podman Desktop is a GUI tool that helps with running and managing containers on our local machine, but it can also help with running AI models locally as well thanks to its AI Lab extension. Thanks to Quarkus and LangChain4j it then becomes trivial to start developing with these models. Let&#8217;s find out how!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_podman_desktop_ai"><a class="anchor" href="#_installing_podman_desktop_ai"></a>Installing Podman Desktop AI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, if you haven&#8217;t yet, you must download and install Podman Desktop on your operating system. <a href="https://podman-desktop.io/downloads" target="_blank" rel="noopener">The instructions can be found here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Windows/Mac users, if you can, give the podman machine at least 8GB of memory and 4 CPU (Generative AI Models are resource hungry!). The model will run with less resources, but it will be significantly slower.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once installed, go ahead and start the application and go through the setup process. After that, you should see an "AI Lab" extension in the left menu. If you don&#8217;t, you may need to install the extension first. For that, go to Extensions &#8594; Catalog and install Podman AI Lab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/podman-desktop-ai.png" alt="podman desktop ai">
</div>
</div>
<div class="paragraph">
<p>Go ahead and click on it, and in the AI Lab, select the "Catalog"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/podman-desktop-ai-catalog.png" alt="podman desktop ai catalog">
</div>
</div>
<div class="paragraph">
<p>You should now see a list of available AI Models choose from. You can also import different ones (eg. from Huggingface), but we will use one of the InstructLab models that are already available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you haven&#8217;t heard of <a href="https://developers.redhat.com/articles/2024/05/07/instructlab-open-source-generative-ai">Instructlab</a>, it&#8217;s an open source project for enhancing large language models (LLMs) used in generative artificial intelligence (gen AI) applications. You can even contribute to it yourself!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start using the model, we&#8217;ll first need to download it, so go ahead and do that with the download button <span class="image"><img src="_images/podman-desktop-model-download.png" alt="download button" width="30"></span> next to the instructlab/merlinite-7b-lab-GGUF entry (this might take a little while).</p>
</div>
<div class="paragraph">
<p>Once downloaded, you can create a new model service by clicking on the rocket button <span class="image"><img src="_images/podman-desktop-create-model-service.png" alt="rocket button" width="30"></span> that will appear where you previously clicked the download button.</p>
</div>
<div class="paragraph">
<p>You will be taken to the "Creating Model Service" page where you can set the port that should be exposed for the service. Podman Desktop assigns a random available port by default, but let&#8217;s set it to <code><strong>35000</strong></code> so we can remember more easily what the port is when we configure our Quarkus application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/podman-desktop-create-merlinite-service.png" alt="podman desktop create merlinite service">
</div>
</div>
<div class="paragraph">
<p>After a few moments, your very own Model service will be running locally on your laptop! You an check the details on the Service details page, including some samples to test out the service with cURL (or even Java!).</p>
</div>
<div class="paragraph">
<p>Now it&#8217;s time to go back to our Quarkus application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The InstructLab service uses the OpenAI protocol, so we can continue to use the quarkus-langchain4j-openai extension for this exercise
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_new_project"><a class="anchor" href="#_creating_a_new_project"></a>Creating a new project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some of the exercises we completed previously are not compatible with non-OpenAI models, so let&#8217;s create a fresh new project</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_maven"></a>Maven</p>
</li>
<li>
<p><a id="tabset1_quarkus-cli"></a>Quarkus CLI</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_maven">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn "io.quarkus.platform:quarkus-maven-plugin:create" -DprojectGroupId="com.redhat.developers" -DprojectArtifactId="quarkus-podman-ai-app" -DprojectVersion="1.0-SNAPSHOT" -Dextensions=langchain4j-openai,rest
cd quarkus-podman-ai-app</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_quarkus-cli">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus create app -x rest langchain4j-openai com.redhat.developers:quarkus-podman-ai-app:1.0-SNAPSHOT
cd quarkus-podman-ai-app</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect_to_the_instructlab_model"><a class="anchor" href="#_connect_to_the_instructlab_model"></a>Connect to the InstructLab Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add the following properties in the <code>application.properties</code> file available in <code>src/main/resources</code>:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.langchain4j.openai.base-url=http://localhost:35000/v1 <i class="conum" data-value="1"></i><b>(1)</b>
# Configure openai server to use a specific model
quarkus.langchain4j.openai.chat-model.model-name=instructlab/merlinite-7b-lab-GGUF <i class="conum" data-value="2"></i><b>(2)</b>
# Set timeout to 3 minutes
quarkus.langchain4j.openai.timeout=180s
# Enable logging of both requests and responses
quarkus.langchain4j.openai.log-requests=true
quarkus.langchain4j.openai.log-responses=true</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Port number 35000 was what we had defined in podman desktop when we created the model service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The model we selected to serve. If you chose a different model in Podman Desktop, you&#8217;ll need to update it here as well.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_ai_service"><a class="anchor" href="#_create_the_ai_service"></a>Create the AI service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s create an interface for our AI service.</p>
</div>
<div class="paragraph">
<p>Create a new <code>AssistantForInstructLab.java</code> Java interface in <code>src/main/java</code> in the <code>com.redhat.developers</code> package with the following contents:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.redhat.developers;

import dev.langchain4j.service.SystemMessage;
import dev.langchain4j.service.UserMessage;
import io.quarkiverse.langchain4j.RegisterAiService;
import jakarta.enterprise.context.SessionScoped;

@RegisterAiService()
@SessionScoped
public interface AssistantForInstructLab {

    @SystemMessage({
            "You are a Java developer who likes to over engineer things" <i class="conum" data-value="1"></i><b>(1)</b>
    })
    String chat(@UserMessage String userMessage);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gives some context to the model</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_prompt_base_resource"><a class="anchor" href="#_create_the_prompt_base_resource"></a>Create the prompt-base resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we&#8217;re going to implement another REST resource that accepts prompts</p>
</div>
<div class="paragraph">
<p>Create a new <code>InstructLabResource.java</code> Java class in <code>src/main/java</code> in the <code>com.redhat.developers</code> package with the following contents:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.redhat.developers;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.QueryParam;
import jakarta.ws.rs.core.MediaType;

@Path("/instructlab")
public class InstructLabResource {

    @Inject
    AssistantForInstructLab assistant;

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String prompt() {
        // feel free to update this message to any question you may have for the LLM.
        String message = "Generate a class that returns the square root of a given number";
        return assistant.chat(message);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_invoke_the_endpoint"><a class="anchor" href="#_invoke_the_endpoint"></a>Invoke the endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s ask our model to create a class that returns the square root of a given number:</p>
</div>
<div class="paragraph">
<p>You can check your prompt implementation by pointing your browser to <a href="http://localhost:8080/instructlab" class="bare" target="_blank" rel="noopener">http://localhost:8080/instructlab</a></p>
</div>
<div class="paragraph">
<p>You can also run the following command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl http://localhost:8080/instructlab</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example of output (remember, your result will likely be different):</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Here is a simple Java class to calculate the square root of a given number using the built-in `Math` class in Java:

```java
public class SquareRootCalculator {
    public static void main(String[] args) {
        int num = 16; // square root of 16 is 4.0
        double result = Math.sqrt(num);
        System.out.println("Square root of " + num + ": " + result);
    }
}
```

Alternatively, if you want to handle negative numbers or non-integer inputs, you can use the `Math.sqrt()` function directly:

```java
public class SquareRootCalculator {
    public static void main(String[] args) {
        double num = -16; // square root of -16 is -4.0
        double result = Math.sqrt(num);
        System.out.println("Square root of " + num + ": " + result);
    }
}
```

This will allow you to calculate the square root of any given number, positive or negative, and handle non-integer inputs.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
depending on your local resources, this might take a up to a few minutes. If you run into timeouts,
you can try changing the <code>quarkus.langchain4j.openai.timeout</code> value in the application.properties file.
If you&#8217;re running on Mac/Windows, you could also try to give the podman machine more CPU/Memory resources.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that (at least in our case) the LLM responded with a Java class, since we provided in the SystemMessage that the
LLM should respond as if they were a Java engineer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_going_further"><a class="anchor" href="#_going_further"></a>Going further</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feel free to play around with the different models Podman Desktop AI Lab provides. You will notice that some are faster
than others, and some will respond better to specific questions than others, based on how they have been trained.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to help improve the answers generated by the InstructLab model, feel free to <a href="https://github.com/instructlab/community/blob/main/README.md">contribute to the project</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="20_embed_documents.html">Embedding Documents</a></span>
  <span class="next"><a href="22_local_models.html">Working with local models</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
